(function(a){a.fn.associateInteraction=function(b){var c=a.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,opened:false,unrestricted:false},b);try{if(typeof c.responseValue!="undefined"&&c.responseValue.length>0){drawAssociations(this,c)}if(c.opened){associate(this,c)}}catch(d){if(window.console){console.log(d)}}return this};drawAssociations=function(b,f){var j=b.attr("id");var m=f.responseValue.split(",");var k=jQuery("#"+j+"_panel .association");for(var g=0;g<m.length;g++){var e=m[g].split(" ");var h=jQuery(k.get(g));if(h.size()==0){var l=newAssociationBox(j,f);h=jQuery("#"+l)}var d=jQuery("#"+j+"_items div[data-qti-id='"+e[0]+"']");if(needToBeAvailable(d,j)){d=jQuery(d).clone()}var c=jQuery("#"+j+"_items div[data-qti-id='"+e[1]+"']");if(needToBeAvailable(c,j)){c=jQuery(c).clone()}jQuery(d).addClass("oo-choosed");jQuery(c).addClass("oo-choosed");jQuery(h.find(".association_box.left")).addClass("oo-filled").append(d);jQuery(h.find(".association_box.right")).addClass("oo-filled").append(c)}recalculate(j,f);if(f.unrestricted&&f.opened){addNewAssociationBoxAndEvents(j,f)}};associate=function(f,d){var b=f.attr("id");var c=jQuery("#"+b+" .o_associate_item");initializeGapEvents(c,b,d);var e=jQuery("#"+b+"_panel .association_box");initializeAssociationBoxEvents(e,b,d)};initializeGapEvents=function(c,b,d){c.on("click",function(h,g){var f=jQuery(this);if(!f.hasClass("oo-choosed")&&!f.hasClass("oo-selected")){f.addClass("oo-selected")}}).draggable({containment:"#"+b,scroll:false,revert:"invalid",stop:function(e,f){jQuery(this).css({left:"0px",top:"0px"});jQuery(f.helper).removeClass("oo-drag")},helper:function(){var f=jQuery(this);var g=f.parent(".association_box").size()>0;if(!g&&needToBeAvailable(this,b)){f.removeClass("oo-selected");var e=f.clone();jQuery(e).attr("id","n"+guid()).data("qti-cloned","true").addClass("oo-drag");return e}f.addClass("oo-drag");return f}}).on("click",{formId:d.formDispatchFieldId},setFlexiFormDirtyByListener)};needToBeAvailable=function(g,c){var f=jQuery(g);var e=f.data("qti-match-max");var b=f.data("qti-id");var d=jQuery("#"+c+"_panel div[data-qti-id='"+b+"']").size();return(e==0||d+1<e)};initializeAssociationBoxEvents=function(c,b,d){c.on("click",function(h,f){var g=jQuery(this);var i=jQuery(".o_associate_item",this).size();if(i==1){jQuery(".o_associate_item",this).each(function(e,j){removeGap(j,g,b)})}else{jQuery("#"+b+"_items .o_associate_item.oo-selected").each(function(e,k){var j=jQuery(k);if(needToBeAvailable(k,b)){j.removeClass("oo-selected");moveGap(j.clone(),g,b)}else{moveGap(j,g,b)}})}recalculate(b,d);setFlexiFormDirty(d.formDispatchFieldId,false)}).droppable({drop:function(g,h){var f=jQuery(this);var i=jQuery(".o_associate_item",this).size();if(i>0){jQuery(".o_associate_item",this).each(function(j,k){removeGap(k,f,b)})}var e;if(h.helper!=null&&jQuery(h.helper).data("qti-cloned")=="true"){var e=jQuery(h.draggable);e.removeClass("oo-selected").removeClass("oo-drag");e=e.clone();initializeGapEvents(e,b,d);moveGap(e,f,b)}else{var e=jQuery(h.draggable);e.removeClass("oo-selected").removeClass("oo-drag");moveGap(e,f,b)}recalculate(b,d);setFlexiFormDirty(d.formDispatchFieldId,false)}}).on("click",{formId:d.formDispatchFieldId},setFlexiFormDirtyByListener)};moveGap=function(d,c,b){d.removeClass("oo-selected").css({left:"0px",top:"0px"}).addClass("oo-choosed").appendTo(c);c.addClass("oo-filled")};removeGap=function(g,f,c){f.removeClass("oo-filled");var e=jQuery(g);e.removeClass("oo-choosed");var b=e.data("qti-id");var d=jQuery("#"+c+"_items div[data-qti-id='"+b+"']").size();if(d==0){e.appendTo(jQuery("#"+c+"_items"))}else{e.remove()}};guid=function(){function b(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return b()+b()+b()+b()+b()+b()+b()};recalculate=function(b,d){var c=jQuery("#"+b+"_panel");c.find("input[type='hidden']").remove();jQuery("#"+b+"_panel .association").each(function(e,j){var g=jQuery(j).find(".o_associate_item");if(g.length==2){var h=jQuery(g.get(0)).data("qti-id");var f=jQuery(g.get(1)).data("qti-id");var i=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+d.responseIdentifier).attr("value",h+" "+f);c.prepend(i)}else{if(g.length==0&&d.unrestricted){j.remove()}else{jQuery(j).find(".association_box").each(function(m,l){var k=jQuery(l).find(".o_associate_item").size();if(k==0&&jQuery(l).hasClass("oo-filled")){jQuery(l).removeClass("oo-filled")}})}}});addNewAssociationBoxAndEvents(b,d)};addNewAssociationBoxAndEvents=function(b,e){if(!e.unrestricted||!e.opened){return}var c=jQuery("#"+b+"_panel");var d=true;jQuery("#"+b+"_panel .association").each(function(h,j){var i=jQuery(j).find(".o_associate_item");if(i.length!=2){d=false}});if(d){var g=newAssociationBox(b,e);var f=jQuery("#"+g+" .association_box");initializeAssociationBoxEvents(f,b,e)}};newAssociationBox=function(b,c){var d=guid();var e='<div id="'+d+'" class="association" style="">\n  <div class="association_box left" style="width: 100px; height:50px; float:left;"></div>\n  <div class="association_box right" style="width: 100px; height:50px; float:right;"></div>\n  <div style="clear:both; "></div>\n</div>\n';jQuery("#"+b+"_panel").append(e);jQuery("#"+b+"_panel").append('<div style="clear:both; "></div>\n');return d}}(jQuery));(function(f){f.fn.gapMatchInteraction=function(h){var j=f.extend({responseIdentifier:null,formDispatchFieldId:null,gapChoiceData:{},gapData:{},opened:false,gapChoiceMap:{},gapMap:{},matched:{}},h);for(var i in j.gapChoiceData){var k=jQuery("#qtiworks_id_"+j.responseIdentifier+"_"+i);j.gapChoiceMap[i]={matchMax:j.gapChoiceData[i],matchCount:0,query:k,text:k.text()}}for(var i in j.gapData){var k=jQuery("#qtiworks_id_"+j.responseIdentifier+"_"+i);j.gapMap[i]={required:j.gapData[i],matched:false,matchedGapChoice:null,query:k,label:k.text()}}try{d(this,j)}catch(l){if(window.console){console.log(l)}}return this};function b(j,k,n){var m=k.value;var i=m.split(" ");var h=j.gapChoiceMap[i[0]];var l=j.gapMap[i[1]];n(j,k,m,h,l)}function d(i,h){if(h.opened){e(h.responseIdentifier).on("click",function(){a(h,this);setFlexiFormDirty(h.formDispatchFieldId)})}c(h);g(h)}function e(h){return jQuery("input[name=qtiworks_response_"+h+"]")}function c(j){j.matchCount=0;for(var i in j.gapChoiceMap){j.gapChoiceMap[i].matchCount=0}for(var i in j.gapMap){j.gapMap[i].matched=false;j.gapMap[i].matchedGapChoice=null}e(j.responseIdentifier).each(function(l,m){b(j,this,function(o,p,r,n,q){if(p.checked){n.matchCount++;q.matched=true;q.matchedGapChoice=n;o.matched[r]=true}})});for(var i in j.gapMap){var k=j.gapMap[i];var h;if(k.matched){h=k.matchedGapChoice.text}else{h=k.label}k.query.text(h)}}function g(h){e(h.responseIdentifier).each(function(){b(h,this,function(j,k,m,i,l){if(!j.opened){k.disabled=true}else{if(k.checked){k.disabled=false}else{if(l.matched||(i.matchMax!=0&&i.matchCount>=i.matchMax)){k.disabled=true}else{k.disabled=false}}}})})}function a(h,i){b(h,i,function(k,l,n,j,m){if(l.checked){if(m.matched||(j.matchMax!=0&&j.matchMax<=j.matchCount)){l.checked=false}else{j.matchCount++;m.matched=true;m.matchedGapChoice=j}m.query.text(j.text)}else{j.matchCount--;m.matched=false;m.matchedGapChoice=null;m.query.text(m.label)}g(k)})}}(jQuery));(function(d){d.fn.graphicAssociateInteraction=function(g){var h=d.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxAssociations:1,opened:false},g);try{if(!(typeof h.responseValue==="undefined")&&h.responseValue.length>0){e(this,h.responseValue,h.responseIdentifier)}if(h.opened){c(this,h.maxAssociations,h.responseIdentifier)}}catch(j){if(window.console){console.log(j)}}return this};function c(k,j,h){var g=k.attr("id");jQuery("#"+g+"_container area").on("click",function(t){var l=8;var q=jQuery("#"+g+"_container").data("openolat")||{};if(q.listOfPairs==undefined){q.currentSpot="";q.listOfPairs=[];jQuery("#"+g+"_container").data("openolat",q)}var w=jQuery(this).data("qti-id");if(q.currentSpot==""||q.currentSpot==w){q.currentSpot=w}else{var A=[q.currentSpot,w];q.listOfPairs.push(A);q.currentSpot=""}var m=document.getElementById(g+"_canvas");var u=m.getContext("2d");u.clearRect(0,0,jQuery(m).width(),jQuery(m).height());var B=jQuery("#"+g+"_container");B.find("input[type='hidden']").remove();var z=[];if(q.currentSpot!=""){b(u,"ac_"+h+"_"+q.currentSpot);z.push(q.currentSpot)}for(var p=q.listOfPairs.length;p-->0;){var o=q.listOfPairs[p];for(var n=o.length;n-->0;){if(0>z.indexOf(o[n])){b(u,"ac_"+h+"_"+o[n]);z.push(o[n])}}var s=jQuery("#ac_"+h+"_"+o[1]);var v=jQuery("#ac_"+h+"_"+o[0]);var C=f(s);var y=f(v);u.beginPath();u.moveTo(C[0],C[1]);u.lineTo(y[0],y[1]);u.lineWidth=3;u.stroke();var x=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+h).attr("value",v.data("qti-id")+" "+s.data("qti-id"));B.prepend(x)}})}function e(g,v,t){var o=g.attr("id");var x=jQuery("#"+o+"_container");var k=document.getElementById(o+"_canvas");var q=k.getContext("2d");q.clearRect(0,0,jQuery(k).width(),jQuery(k).height());var w=[];var h=v.split(",");for(var n=h.length;n-->0;){var m=h[n].split(" ");for(var l=m.length;l-->0;){if(0>w.indexOf(m[l])){b(q,"ac_"+t+"_"+m[l]);w.push(m[l])}}if(m.length==2){var p=jQuery("#ac_"+t+"_"+m[1]);var r=jQuery("#ac_"+t+"_"+m[0]);var y=f(p);var u=f(r);q.beginPath();q.moveTo(y[0],y[1]);q.lineTo(u[0],u[1]);q.lineWidth=3;q.stroke();var s=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+t).attr("value",r.data("qti-id")+" "+p.data("qti-id"));x.prepend(s)}}}function b(h,g){jQuery("#"+g).each(function(k,m){var l=jQuery(m);var n=f(l);var j=l.attr("shape");a(h,j,n,0,0)})}function a(j,g,k,h,l){h=h||0;l=l||0;j.beginPath();if(g=="rect"){j.rect(k[0]+h,k[1]+l,k[2]-k[0],k[3]-k[1])}else{if(g=="poly"){j.moveTo(k[0]+h,k[1]+l);for(i=2;i<k.length;i+=2){j.lineTo(k[i]+h,k[i+1]+l)}}else{if(g=="circ"||g=="circle"){j.arc(k[0]+h,k[1]+l,k[2]-2,0,Math.PI*2,false)}}}j.closePath();j.lineWidth=4;j.strokeStyle="#003300";j.stroke();j.fillStyle="green";j.fill()}function f(g){var h=g.attr("coords").split(",");for(i=h.length;i-->0;){h[i]=parseFloat(h[i])}return h}}(jQuery));(function(f){f.fn.graphicGapInteraction=function(j){var k=f.extend({maphilight:null,responseIdentifier:null,formDispatchFieldId:null,responseValue:null,opened:false},j);try{if(!(typeof k.responseValue==="undefined")&&k.responseValue.length>0){b(this,k)}if(k.opened){c(this,k)}}catch(l){if(window.console){console.log(l)}}return this};function b(j,m){var q=j.attr("id");var v=jQuery("#"+q);var l=m.responseValue.split(",");for(var n=l.length;n-->0;){var k=l[n].split(" ");var p=jQuery("#ac_"+m.responseIdentifier+"_"+k[0]);var o=jQuery("#ac_"+m.responseIdentifier+"_"+k[1]);var r,u;if(p.hasClass("gap_item")){r=p;u=o}else{r=o;u=p}var s=g(u);r.css("position","absolute");r.css("left",s[0]+"px");r.css("top",s[1]+"px");r.addClass("oo-choosed");var t=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+m.responseIdentifier).attr("value",r.data("qti-id")+" "+u.data("qti-id"));v.prepend(t)}}function c(l,k){var j=l.attr("id");jQuery(".gap_item").on("click",function(q,p){var o=jQuery(this);if(o.hasClass("oo-choosed")){var n=o.data("drop-timestamp");if(!(typeof n==="undefined")&&n!=null){if((Date.now()-n)<1500){o.data("drop-timestamp",null);return}}o.removeClass("oo-choosed");var m=o.data("qti-id");jQuery("#"+j).find("input[type='hidden']").each(function(r,s){var t=jQuery(s).val();if(t.indexOf(m+" ")==0){jQuery(s).remove()}});o.css({position:"relative",left:"0px",top:"0px"})}else{o.addClass("oo-selected")}}).draggable({containment:"#"+j,scroll:false,revert:"invalid",stop:function(m,n){if(!jQuery(this).hasClass("oo-choosed")){jQuery(this).css({position:"relative",left:"0px",top:"0px"})}}}).mousemove(function(m,s){var u=jQuery(this);if(u.hasClass("ui-draggable-dragging")){var q=jQuery("#"+j+"_img");var p=q.offset();var o=u.offset();var n=o.left+(u.width()/2)-p.left;var t=o.top+(u.height()/2)-p.top;var r=h(n,t,j);if("invalid"!=r){jQuery("#"+j+" area").each(function(v,x){var w=jQuery(x);var y=w.attr("id");if(r==y){w.mouseover()}else{w.mouseout()}});jQuery("#"+r).mouseover()}else{jQuery("#"+j+" area").each(function(v,w){jQuery(w).mouseout()})}}});jQuery("#"+j).droppable({drop:function(m,t){var r=jQuery("#"+j+"_img");var p=r.offset();var u=jQuery(t.draggable);var o=u.offset();var n=o.left+(u.width()/2)-p.left;var w=o.top+(u.height()/2)-p.top;var s=h(n,w,j);if("invalid"!=s){var z=jQuery("#"+s);var v=g(z);var x=z.data("qti-id");var q=u.data("qti-id");u.css("position","absolute");u.css("left",v[0]+"px");u.css("top",v[1]+"px");u.css("border","none");u.removeClass("oo-selected");u.addClass("oo-choosed");var y=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+k.responseIdentifier).attr("value",q+" "+x);jQuery(this).prepend(y);jQuery(z).mouseout();u.data("drop-timestamp",Date.now())}}});jQuery("#"+j+" area").on("click",function(o,n){var m=jQuery(this);jQuery(".gap_item.oo-selected").each(function(q,s){var r=jQuery(s);var t=g(m);var w=m.data("qti-id");var v=r.data("qti-id");r.css("position","absolute");r.css("left",t[0]+"px");r.css("top",t[1]+"px");r.css("border","none");r.removeClass("oo-selected");r.addClass("oo-choosed");var p=jQuery("#"+j);var u=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+k.responseIdentifier).attr("value",v+" "+w);p.prepend(u)})})}function h(l,k,j){var m="invalid";jQuery("#"+j+" area").each(function(r,o){var v=jQuery(o);var u=v.attr("id");var t=v.attr("coords");var s=v.attr("shape");var w=g(v);if("circle"==s){if(a(l,k,w[0],w[1],w[2])){m=u}}else{if("rect"==s){if(d(l,k,w[0],w[1],w[2],w[3])){m=u}}else{if("poly"==s){var n={};n.x=[];n.y=[];var q=w.length/2;var p=0;for(ix=0;ix<q;ix++){n.x[ix]=w[p];n.y[ix]=w[p+1];p+=2}for(i=0;i<n.length;i++){if(e(n.x.length,n.x,n.y,l,k)){m=n.id;break}}}}}});return m}function a(k,o,m,l,j){var n=Math.pow(k-m,2)+Math.pow(o-l,2);return Math.pow(j,2)>=n}function d(j,o,n,l,k,m){if((n<=j)&&(j<=k)&&(l<=o)&&(o<=m)){return true}else{return false}}function e(l,p,o,k,r){var n,m,q=false;for(n=0,m=l-1;n<l;m=n++){if(((o[n]>r)!=(o[m]>r))&&(k<(p[m]-p[n])*(r-o[n])/(o[m]-o[n])+p[n])){q=!q}}return q}function g(j){var k=j.attr("coords").split(",");for(i=k.length;i-->0;){k[i]=parseFloat(k[i])}return k}}(jQuery));(function(c){c.fn.graphicOrderInteraction=function(d){var f=c.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxChoices:1,opened:false},d);try{if(!(typeof f.responseValue==="undefined")&&f.responseValue.length>0){b(this,f)}if(f.opened){a(this,f)}}catch(g){if(window.console){console.log(g)}}return this};function b(d,h){var m=d.attr("id");var r=jQuery("#"+m+"_container");var e=document.getElementById(m+"_canvas");var o=e.getContext("2d");o.clearRect(0,0,jQuery(e).width(),jQuery(e).height());var n=h.responseValue.split(",");for(var k=n.length;k-->0;){if(n[k].length==0){continue}var q=jQuery("#ac_"+h.responseIdentifier+"_"+n[k]);var f=q.data("qti-id");var l=q.attr("coords").split(",");var j=l[0];var g=l[1];o.font="16px Arial";o.fillText(""+(k+1),j,g);var p=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+h.responseIdentifier).attr("value",f);r.prepend(p)}}function a(f,e){var d=f.attr("id");jQuery("#"+d+"_container area").on("click",function(v){var h=8;var x=jQuery(this).attr("id");var l=jQuery(this).data("qti-id");var u=jQuery(this).attr("coords").split(",");var o=u[0];var n=u[1];var t=jQuery("#"+d+"_container").data("openolat")||{};if(t.listOfPoints==undefined){t.listOfPoints=[];jQuery("#"+d+"_container").data("openolat",t)}var s=false;var m=[];for(var q=t.listOfPoints.length;q-->0;){var j=t.listOfPoints[q];var g=((j.x-o)*(j.x-o))+((j.y-n)*(j.y-n));if(h*h>g){s=true}else{m.push(j)}}if(s){t.listOfPoints=m}else{if(t.listOfPoints.length>=e.maxChoices){return false}else{t.listOfPoints.push({x:o,y:n,areaId:x,spotQtiId:l})}}var k=document.getElementById(d+"_canvas");var w=k.getContext("2d");w.clearRect(0,0,jQuery(k).width(),jQuery(k).height());var z=jQuery("#"+d+"_container");z.find("input[type='hidden']").remove();for(var q=t.listOfPoints.length;q-->0;){var j=t.listOfPoints[q];w.font="16px Arial";w.fillText(""+(q+1),j.x,j.y);var y=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+e.responseIdentifier).attr("value",j.spotQtiId);z.prepend(y)}})}}(jQuery));(function(c){c.fn.hotspotInteraction=function(f){var g=c.extend({responseIdentifier:null,formDispatchFieldId:null,maxChoices:1,responseValue:null,opened:false},f);try{if(!(typeof g.responseValue==="undefined")&&g.responseValue.length>0){a(this,g)}if(g.opened){e(this,g)}}catch(h){if(window.console){console.log(h)}}return this};function a(n,k){var f=n.attr("id");var g=jQuery("#"+f);var j=k.responseValue.split(",");for(i=j.length;i-->0;){var h=jQuery("#ac_"+k.responseIdentifier+"_"+j[i]);var l=h.data("maphilight")||{};l.selectedOn=true;b(l);h.data("maphilight",l).trigger("alwaysOn.maphilight");var m=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+k.responseIdentifier).attr("value",h.data("qti-id"));g.append(m)}}function e(h,g){var f=h.attr("id");jQuery("#"+f+" map area").each(function(j,k){jQuery(k).on("click",function(){d(this,f,g.responseIdentifier,g.maxChoices)})})}function d(l,j,n,k){var m=jQuery(l);var h=m.data("maphilight")||{};if((typeof h.selectedOn==="undefined")||!h.selectedOn){var f=k;if(f>0){var g=0;jQuery("area","map[name='"+j+"_map']").each(function(p,r){var q=jQuery(r).data("maphilight")||{};if(q.selectedOn){g++}});if(g>=f){return false}}}if(typeof h.selectedOn==="undefined"){h.selectedOn=true}else{h.selectedOn=!h.selectedOn}b(h);m.data("maphilight",h).trigger("alwaysOn.maphilight");var o=jQuery("#"+j);o.find("input[type='hidden']").remove();jQuery("area","map[name='"+j+"_map']").each(function(p,r){var s=jQuery(r);var q=s.data("maphilight")||{};if(q.selectedOn){var t=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+n).attr("value",s.data("qti-id"));o.append(t)}})}function b(f){if(f.selectedOn){f.fillColor="0000ff";f.fillOpacity=0.5;f.strokeColor="0000ff";f.strokeOpacity=1;f.shadow=true;f.shadowX=0;f.shadowY=0;f.shadowRadius=7;f.shadowColor="000000";f.shadowOpacity=0.8;f.shadowPosition="outside"}else{f.fillColor="bbbbbb";f.fillOpacity=0.5;f.strokeColor="666666";f.strokeOpacity=0.8;f.shadow=false}}}(jQuery));(function(f){f.fn.matchInteraction=function(h){var j=f.extend({responseIdentifier:null,formDispatchFieldId:null,maxAssociations:1,leftData:{},rightData:{},leftMap:{},rightMap:{},matched:[]},h);for(var i in j.leftData){j.leftMap[i]={matchMax:j.leftData[i],matchCount:0}}for(var i in j.rightData){j.rightMap[i]={matchMax:j.rightData[i],matchCount:0}}try{d(this,j)}catch(k){if(window.console){console.log(k)}}return this};function d(i,h){e(h.responseIdentifier).on("click",function(){a(h,this)});c(h);g(h)}function e(h){return jQuery("input[name=qtiworks_response_"+h+"]")}function b(j,l,n){var m=l.value;var h=m.split(" ");var k=j.leftMap[h[0]];var i=j.rightMap[h[1]];n(l,m,k,i)}function c(i){i.matchCount=0;i.matched={};for(var h in i.leftMap){i.leftMap[h].matchCount=0}for(var h in i.rightMap){i.rightMap[h].matchCount=0}e(i.responseIdentifier).each(function(){b(i,this,function(l,m,k,j){if(l.checked){i.matchCount++;k.matchCount++;j.matchCount++;i.matched[m]=true}})})}function g(h){e(h.responseIdentifier).each(function(){b(h,this,function(k,l,j,i){if(k.checked){k.disabled=false}else{if((h.maxAssociations!=0&&h.matchCount>=h.maxAssociations)||(j.matchMax!=0&&j.matchCount>=j.matchMax)||(i.matchMax!=0&&i.matchCount>=i.matchMax)){k.disabled=true}else{k.disabled=false}}})})}function a(h,i){b(h,i,function(m,n,l,k){if(m.checked){var j=false;if(l.matchMax!=0&&l.matchMax<=l.matchCount){m.checked=false}else{l.matchCount++;h.matchCount++;j=true}if(k.matchMax!=0&&k.matchMax<=k.matchCount){m.checked=false}else{k.matchCount++;if(!j){h.matchCount++}}}else{h.matchCount--;l.matchCount--;k.matchCount--}g(h)})}}(jQuery));(function(c){c.fn.orderInteraction=function(d){var f=c.extend({responseIdentifier:null,formDispatchFieldId:null,initialSourceOrder:null,initialTargetOrder:null,responseValue:null,minChoices:null,maxChoices:null},d);try{a(this,f)}catch(g){if(window.console){console.log(g)}}return this};function a(k,f){var j=jQuery("#qtiworks_response_"+f.responseIdentifier);var d=jQuery("#qtiworks_response_"+f.responseIdentifier+" div.target");var g=jQuery("#qtiworks_response_"+f.responseIdentifier+" div.source ul");var i=jQuery("#qtiworks_response_"+f.responseIdentifier+" div.target ul");var e=jQuery("#qtiworks_response_"+f.responseIdentifier+" div.hiddenInputContainer");var h="#qtiworks_response_"+f.responseIdentifier+" ul";g.sortable({connectWith:h,stop:function(){b(f);setFlexiFormDirty(f.formDispatchFieldId)}});g.disableSelection();i.sortable({connectWith:h,stop:function(){b(f);setFlexiFormDirty(f.formDispatchFieldId)}});i.disableSelection()}function b(f){var g=jQuery("#qtiworks_response_"+f.responseIdentifier+" div.source ul");var h=jQuery("#qtiworks_response_"+f.responseIdentifier+" div.target ul");var e=h.children("li").size();if(f.minChoices!=null&&f.maxChoices!=null){if(e<f.minChoices||e>f.maxChoices){if(f.minChoices!=f.maxChoices){alert("You must select and order between "+f.minChoices+" and "+f.maxChoices+" items")}else{alert("You must select and order exactly "+f.minChoices+" item"+(minChoices>1?"s":""))}targetBox.toggleClass("highlight",true);return false}else{targetBox.toggleClass("highlight",false)}}var d=jQuery("#qtiworks_response_"+f.responseIdentifier+" div.hiddenInputContainer");d.empty();h.children("li").each(function(j){var i=this.id.substring("qtiworks_response_".length);var k=jQuery('<input type="hidden">');k.attr("name","qtiworks_response_"+f.responseIdentifier);k.attr("value",i);d.append(k)})}}(jQuery));(function(b){b.fn.positionObjectStage=function(f){var g=b.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxChoices:1,opened:false},f);try{var d=this.attr("id");jQuery("#"+d+" .items_container .o_item.o_"+g.responseIdentifier).each(function(e,i){jQuery(i).attr("id","object-item-"+e)});if(!(typeof g.responseValue==="undefined")&&g.responseValue.length>0){c(this,g)}if(g.opened){a(this,g)}}catch(h){if(window.console){console.log(h)}}return this};function c(d,f){var k=d.attr("id");var r=jQuery("#"+k);var j=f.responseValue.split(":");var l=jQuery("#"+k+" .items_container .o_item.o_"+f.responseIdentifier);for(var h=j.length;h-->0;){var n=j[h].split(" ");var g=n[0];var e=n[1];var q=jQuery(l.get(h));q.css("position","absolute");q.css("top",e+"px");q.css("left",g+"px");var m=q.attr("id");var o="in-"+m+"-"+f.responseIdentifier;var p=jQuery('<input type="hidden"/>').attr("id",o).attr("name","qtiworks_response_"+f.responseIdentifier).attr("value",g+" "+e);r.prepend(p)}}function a(g,f){var d=g.attr("id");var e=jQuery("#"+d);jQuery("#"+d+" .items_container .o_item.o_"+f.responseIdentifier).draggable({containment:"#"+d,scroll:false,stop:function(h,p){var i=jQuery("#"+d+"_img");var k=jQuery(i).offset().top-jQuery(window).scrollTop();var n=jQuery(i).offset().left-jQuery(window).scrollLeft();var m=jQuery(this).offset().top-jQuery(window).scrollTop();var q=jQuery(this).offset().left-jQuery(window).scrollLeft();var l=Math.round((q-n));var j=Math.round((m-k));var o=jQuery(this).attr("id");var r="in-"+o+"-"+f.responseIdentifier;var s=e.find("#"+r);if(s.length==0){var t=jQuery('<input type="hidden"/>').attr("id",r).attr("name","qtiworks_response_"+f.responseIdentifier).attr("value",l+" "+j);e.prepend(t)}else{s.val(l+" "+j)}setFlexiFormDirty(f.formDispatchFieldId)}})}}(jQuery));(function(a){a.fn.qtiAutosave=function(b){var c=a.extend({responseUniqueId:null,formName:null,dispIdField:null,dispId:null,eventIdField:null},b);var f=this.attr("id");var e=jQuery.periodic({period:60000,decay:1,max_period:Number.MAX_VALUE},function(){try{var j=jQuery("#"+f).data("auto-save-periodic");if(jQuery("#"+f).length>0&&(typeof e.dateNowMarker==="undefined"||j==e.dateNowMarker)){var g=new Object();g.dispatchuri=c.dispId;g.dispatchevent="2";g.cid="tmpResponse";g.tmpResponse="qtiworks_presented_"+c.responseUniqueId;g["qtiworks_presented_"+c.responseUniqueId]="1";g["qtiworks_response_"+c.responseUniqueId]=jQuery("#oo_"+c.responseUniqueId).val();var i=jQuery("#"+c.formName).attr("action");jQuery.ajax(i,{type:"POST",data:g,cache:false,dataType:"json",success:function(q,r,o){var m=new Date();var k=m.getHours();var n=m.getMinutes();var l=k+":"+(n<10?"0":"")+n;var p=jQuery("#"+f).parent().get(0);jQuery("div.o_qti_essay_last_save",p).css("display","block");jQuery("span.o_qti_essay_last_save-time",p).html(l)}})}else{e.cancel()}}catch(h){if(window.console){console.log(h)}}});var d=Date.now();e.dateNowMarker=d;jQuery("#"+f).data("auto-save-periodic",d);return this}}(jQuery));(function(e){e.fn.qtiTimer=function(h){var j=e.extend({startTime:null,availableTime:null,formName:null,dispIdField:null,dispId:null,eventIdField:null},h);if(!(typeof window.qti21TestTimer==="undefined")){window.qti21TestTimer.cancel()}var m=this.attr("id");var i=Date.now()-j.startTime;var l=i+j.availableTime;var g=l-Date.now();a(m,j.availableTime,g);var k=jQuery.periodic({period:1000,decay:1,max_period:g+1000},function(){g=l-Date.now();if(g>=0){a(m,j.availableTime,g)}else{k.cancel();f(j)}});window.qti21TestTimer=k;return this};function f(g){jQuery(".o_sel_assessment_item_submit").prop("disabled","true");jQuery(".o_qti_times_up").css("display","inline");c();if(jQuery("#o_qti_run").length>0){o_ffXHREvent(g.formName,g.dispIdField,g.dispId,g.eventIdField,"2",false,false,false,"cid","timesUp")}}function a(k,j,g){var i=b(j);jQuery("#"+k+" .o_qti_timer_duration").html(i);if(g<0){g=0}var h=b(g);jQuery("#"+k+" .o_qti_timer").html(h);if(g<1*60*1000){d(k,"o_panic")}else{if(g<5*60*1000){d(k,"o_5_minutes")}else{if(g<10*60*1000){d(k,"o_10_minutes")}}}}function d(i,h){var g=jQuery("#"+i);if(!g.hasClass(h)){c();g.removeClass("o_10_minutes").removeClass("o_5_minutes").removeClass("o_panic");g.addClass(h);jQuery(".o_qti_times_message."+h).css("display","inline")}}function c(){jQuery(".o_qti_times_message.o_10_minutes").css("display","none");jQuery(".o_qti_times_message.o_5_minutes").css("display","none");jQuery(".o_qti_times_message.o_panic").css("display","none")}function b(i){var j=Math.floor(i/1000);var h=Math.floor(j/60);j=j-(h*60);var g=Math.floor(h/60);h=h-(g*60);return(g<10?"0":"")+g+(h<10?":0":":")+h+(j<10?":0":":")+j}}(jQuery));(function(a){a.fn.selectPointInteraction=function(d){var f=a.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxChoices:1,opened:false},d);try{if(!(typeof f.responseValue==="undefined")&&f.responseValue.length>0){b(this,f)}if(f.opened){c(this,f)}}catch(g){if(window.console){console.log(g)}}return this};function b(d,h){var e=8;var j=d.attr("id");var q=jQuery("#"+j);var n=h.responseValue.split(":");var g=document.getElementById(j+"_canvas");var k=g.getContext("2d");k.clearRect(0,0,jQuery(g).width(),jQuery(g).height());for(i=n.length;i-->0;){if(n[i].length==0){continue}var f=n[i].split(" ");var m=f[0];var l=f[1];k.beginPath();k.arc(m,l,e,0,Math.PI*2,false);k.stroke();k.closePath();var o=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+h.responseIdentifier).attr("value",m+" "+l);q.append(o)}}function c(f,e){var d=f.attr("id");jQuery("#"+d+"_canvas").on("click",function(u,z){var h=8;var q=jQuery(this).offset().top-jQuery(window).scrollTop();var w=jQuery(this).offset().left-jQuery(window).scrollLeft();var n=Math.round((u.clientX-w));var m=Math.round((u.clientY-q));var s=jQuery("#"+d).data("openolat")||{};if(s.listOfPoints==undefined){s.listOfPoints=[];jQuery("#"+d).data("openolat",s)}var o=false;var l=[];for(i=s.listOfPoints.length;i-->0;){var j=s.listOfPoints[i];var g=((j.x-n)*(j.x-n))+((j.y-m)*(j.y-m));if(Math.pow(h,2)>g){o=true}else{l.push(j)}}if(o){s.listOfPoints=l}else{if(s.listOfPoints.length>=e.maxChoices){return false}else{s.listOfPoints.push({x:n,y:m})}}var k=document.getElementById(d+"_canvas");var v=k.getContext("2d");v.clearRect(0,0,jQuery(k).width(),jQuery(k).height());var y=jQuery("#"+d);y.find("input[type='hidden']").remove();for(i=s.listOfPoints.length;i-->0;){var j=s.listOfPoints[i];v.beginPath();v.arc(j.x,j.y,h,0,Math.PI*2,false);v.stroke();v.closePath();var x=jQuery('<input type="hidden"/>').attr("name","qtiworks_response_"+e.responseIdentifier).attr("value",j.x+" "+j.y);y.append(x)}setFlexiFormDirty(e.formDispatchFieldId)})}}(jQuery));(function(b){b.fn.sliderInteraction=function(c){var d=b.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,min:1,max:1,step:1,orientation:null,isReversed:false,isDiscrete:false,opened:false,initialValue:null},c);try{a(this,d)}catch(f){if(window.console){console.log(f)}}return this};function a(g,d){var e=jQuery("#qtiworks_id_slider_"+d.responseIdentifier);var f=jQuery('input[name="qtiworks_response_'+d.responseIdentifier+'"]');var c=f.get(0).value||d.min;e.slider({value:c,step:d.step,disabled:!d.opened,orientation:d.orientation,min:d.isReversed?-d.max:d.min,max:d.isReversed?-d.min:d.max,slide:function(h,j){var i=d.isReversed?-j.value:j.value;var l=jQuery("#qtiworks_id_slidervalue_"+d.responseIdentifier);var k=jQuery('input[name="qtiworks_response_'+d.responseIdentifier+'"]');k.get(0).value=i;l.text(i);e.slider("value",d.isReversed?-i:i);setFlexiFormDirty(d.formDispatchFieldId)}})}}(jQuery));